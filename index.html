<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
	<script src="/app.js"></script>
    <title>Breakout</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
    
</head>
<body>
	
	<canvas id="myCanvas" width="500" height="400"></canvas>
	<br>
	<div style="margin:auto; color:red; font-size: 50px; text-align:center;">
		Score
	</div>
	<div id="score" style="margin:auto; color:red; font-size: 30px; text-align:center;">
		
	</div>
<script>
    var canvas = document.getElementById("myCanvas");
	var scoreLbl = document.getElementById("score");
    var ctx = canvas.getContext("2d");
	

	var up = false;
	//var down = false;
	var ballRadius = 10;
	var y = canvas.height / 2;
	
	var obstacleWidth = 40;
	
	var obstacleTopX = canvas.width;
	var obstacleBottomX = canvas.width;
	
	var topObstacles = [];
	var bottomObstacles = [];
	var track = 0;
	for(let i = 0 ; i <= 1000; i++){
		let obs = {height : getRandomArbitrary(100, (canvas.height / 2))};
		topObstacles.push(obs);
	}
	for(let i = 0 ; i <= 1000; i++){
		let rand = getRandomArbitrary(100, (canvas.height / 2));
		let obs = {y : canvas.height - rand, height : rand};
		bottomObstacles.push(obs);
	}
	
    
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    function keyUpHandler(e){
        up = false;
        //down = false;
    }
    function keyDownHandler(e) {
        //if(e.key == "Down" || e.key == "ArrowDown") down = true;
        if (e.key == "Up" || e.key == "ArrowUp") up = true;
    }

    var draw = ()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        drawTopObstacle();
		drawBottomObstacle();
		drawCharacter();
		obstacleTopX -= 1;
		obstacleBottomX -= 1;
		if(up) y -= 2;
		else y += 1;
		//else if(down) y += 4;
		if(y < ballRadius) y = ballRadius;
		else if (y > canvas.height - ballRadius) y = canvas.height - ballRadius;
		if(obstacleBottomX + obstacleWidth < 0 && obstacleTopX + obstacleWidth < 0){
			obstacleBottomX = canvas.width;
			obstacleTopX = canvas.width;
			track++;
		};
		
    }
    
	var drawCharacter = () =>{
		ctx.beginPath();
        ctx.arc(ballRadius, y, ballRadius, 0, Math.PI*2);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.closePath();
	};
	var drawTopObstacle = () => {
		ctx.beginPath();
        ctx.rect(obstacleTopX, 0, obstacleWidth, topObstacles[track].height);
        ctx.fillStyle = "green";
        ctx.fill();
        ctx.closePath();
	};
	var drawBottomObstacle = () => {
		//let rand = getRandomArbitrary(0, canvas.height / 2 - ballRadius);
		ctx.beginPath();
        ctx.rect(obstacleBottomX, bottomObstacles[track].y, obstacleWidth, bottomObstacles[track].height);
        ctx.fillStyle = "green";
        ctx.fill();
        ctx.closePath();
	};
    function getRandomArbitrary(min, max) {
		return Math.random() * (max - min) + min;
	}
	var interval = setInterval(draw, 5);
	//draw();
</script>
</body>